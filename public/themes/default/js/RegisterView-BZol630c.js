import{k as e,r as a,$ as l,a8 as t,o,a6 as s,N as r,Q as n,K as i,P as u,Y as d,U as p,j as c,a7 as v,M as m,F as f,R as y,V as g,L as _}from"./vue-vendors-B4XdlKKZ.js";import{u as h,a as b,b as w,p as k,h as $,f as x}from"./index-DZdj2b_n.js";import{_ as j}from"./AuthFormCard.vue_vue_type_script_setup_true_lang-e_3_W4XC.js";import{_ as q,c as U}from"./Layout.vue_vue_type_script_setup_true_lang-Bd80f82b.js";import{_ as z,a as R}from"./PhoneVerifyInput.vue_vue_type_script_setup_true_lang-BZmXwTCl.js";import{m as P,N as S,v as C,w as L,x as A,A as I,s as N,t as O,B as M,o as V,y as B}from"./naive-ui-DFBPfLe9.js";import{L as E}from"./LogInOutline-DKcl_7Vz.js";import"./utils-DGAJShNI.js";import"./icons-C1_zt0kT.js";import"./bg-BQwuMl68.js";import"./photo-components-DTzq5atJ.js";const F={key:0,class:"w-full h-full flex items-center justify-center"},Q={class:"flex justify-between"},D={key:3,class:"mt-8 mb-4"},G={class:"flex flex-row justify-center relative"},K={class:"relative z-[2] text-sm px-4 bg-white dark:bg-[var(--n-color)] text-gray-500"},T={class:"flex justify-center space-x-6 mt-4"},W=e({__name:"RegisterView",setup(e){var W,Y;const H=h(),J=b(),X=w(),Z=a(!0),ee=t(),ae=s(),le=P(),{t:te}=l(),oe=a(null),se=a({email:"",phone:"",name:"",username:"",password:"",password_confirmation:"",code:"",country_code:"cn",token:(null==(Y=null==(W=ee.query)?void 0:W.token)?void 0:Y.toString())||""}),re=async()=>{var e,a;const l=await $({body:se.value});if("error"===(null==(e=l.data)?void 0:e.status))return le.error(null==(a=l.data)?void 0:a.message);le.success(te("Registration successful. Please log in.")),await ae.push("/login")},ne=a("email");return o((()=>{X.isLoggedIn&&ae.push("/user/dashboard").then((()=>{H.setSidebarOpen(!0)})),ee.query.driver_id&&ee.query.code?k({path:{id:ee.query.driver_id.toString()},body:{code:ee.query.code.toString()}}).then((e=>{var a;const l=(null==(a=e.data)?void 0:a.data.token.toString())||"";202===e.status?(ae.replace({query:{token:l}}),se.value.token=l):(async e=>{X.setToken(e),ae.push("/user/dashboard").then((()=>{H.setSidebarOpen(!0)}))})(e.data.data.token).then((()=>{le.success(te("Account exists. Logged in directly."))}))})).finally((()=>{Z.value=!1})):Z.value=!1})),(e,a)=>(_(),r(q,{"header-title":e.$t("Register")},{default:n((()=>{var l;return[Z.value?(_(),i("div",F,[u(d(S),{size:"small",description:"loading..."})])):(_(),r(j,{key:1,title:e.$t("Register a {sitename} account",{sitename:null==(l=d(J).configs)?void 0:l.site.title})},{default:n((()=>{var l,t;return[se.value.token?(_(),r(d(C),{key:0,type:"info",class:"mb-4"},{default:n((()=>[c(v(e.$t("Register a new account and bind it. After binding, you can log in directly next time.")),1)])),_:1})):p("",!0),(null==(l=d(J).configs)?void 0:l.app.user_phone_verify)?(_(),r(d(L),{key:1,type:"segment",class:"mb-4",value:ne.value,"onUpdate:value":a[0]||(a[0]=e=>ne.value=e)},{default:n((()=>[u(d(A),{name:"email"},{default:n((()=>[c(v(e.$t("Register with Email")),1)])),_:1}),u(d(A),{name:"phone"},{default:n((()=>[c(v(e.$t("Register with Mobile Number")),1)])),_:1})])),_:1},8,["value"])):p("",!0),u(d(B),{disabled:!(null==(t=d(J).configs)?void 0:t.app.enable_registration),ref_key:"formRef",ref:oe,model:se.value,"show-require-mark":!0,onSubmit:g(re,["prevent"])},{default:n((()=>{var l,t,o;return["email"===ne.value&&(null==(l=d(J).configs)?void 0:l.app.user_email_verify)?(_(),r(z,{key:0,size:"large",event:"register",email:se.value.email,"onUpdate:email":a[1]||(a[1]=e=>se.value.email=e),code:se.value.code,"onUpdate:code":a[2]||(a[2]=e=>se.value.code=e)},null,8,["email","code"])):"email"===ne.value?(_(),r(d(I),{key:1,label:e.$t("Email"),"show-require-mark":""},{default:n((()=>[u(d(N),null,{default:n((()=>[u(d(O),{value:se.value.email,"onUpdate:value":a[3]||(a[3]=e=>se.value.email=e),"input-props":{type:"email",required:!0},placeholder:e.$t("Please enter your email"),size:"large"},null,8,["value","placeholder"])])),_:1})])),_:1},8,["label"])):p("",!0),"phone"===ne.value?(_(),r(R,{key:2,size:"large",event:"register",phone:se.value.phone,"onUpdate:phone":a[4]||(a[4]=e=>se.value.phone=e),"country-code":se.value.country_code,"onUpdate:countryCode":a[5]||(a[5]=e=>se.value.country_code=e),code:se.value.code,"onUpdate:code":a[6]||(a[6]=e=>se.value.code=e)},null,8,["phone","country-code","code"])):p("",!0),u(d(I),{label:e.$t("Username")},{default:n((()=>[u(d(O),{value:se.value.username,"onUpdate:value":a[7]||(a[7]=e=>se.value.username=e),"input-props":{required:!0},placeholder:e.$t("Please enter your username"),size:"large"},null,8,["value","placeholder"])])),_:1},8,["label"]),u(d(I),{label:e.$t("Name")},{default:n((()=>[u(d(O),{value:se.value.name,"onUpdate:value":a[8]||(a[8]=e=>se.value.name=e),"input-props":{required:!0},placeholder:e.$t("Please enter your name"),size:"large"},null,8,["value","placeholder"])])),_:1},8,["label"]),u(d(I),{label:e.$t("Password")},{default:n((()=>[u(d(O),{value:se.value.password,"onUpdate:value":a[9]||(a[9]=e=>se.value.password=e),placeholder:e.$t("Please enter your password"),type:"password","show-password-on":"mousedown",size:"large","input-props":{required:!0}},null,8,["value","placeholder"])])),_:1},8,["label"]),u(d(I),{label:e.$t("Confirm Password"),"show-feedback":!1},{default:n((()=>[u(d(O),{value:se.value.password_confirmation,"onUpdate:value":a[10]||(a[10]=e=>se.value.password_confirmation=e),placeholder:e.$t("Please confirm your password"),type:"password","show-password-on":"mousedown",size:"large","input-props":{required:!0}},null,8,["value","placeholder"])])),_:1},8,["label"]),u(d(I),null,{default:n((()=>{var a;return[u(d(M),{disabled:!(null==(a=d(J).configs)?void 0:a.app.enable_registration),type:"primary","attr-type":"submit",size:"large",strong:"",block:""},{icon:n((()=>[u(d(V),{component:d(E)},null,8,["component"])])),default:n((()=>[c(" "+v(e.$t("Register")),1)])),_:1},8,["disabled"])]})),_:1}),m("div",Q,[a[12]||(a[12]=m("div",null,null,-1)),m("p",null,[c(v(e.$t("Already have an account?"))+" ",1),u(d(M),{text:"",type:"info",onClick:a[11]||(a[11]=e=>d(ae).push({path:"/login",query:{token:se.value.token||void 0}}))},{default:n((()=>[c(v(e.$t("Go to Login")),1)])),_:1})])]),!se.value.token&&((null==(t=d(J).configs)?void 0:t.app.socialites)||[]).length>0?(_(),i("div",D,[m("div",G,[a[13]||(a[13]=m("div",{class:"absolute top-[10px] h-[1px] bg-gray-200 dark:bg-gray-500 w-[80%] z-[1]"},null,-1)),m("p",K,v(e.$t("Register with Other Methods")),1)]),m("div",T,[(_(!0),i(f,null,y(null==(o=d(J).configs)?void 0:o.app.socialites,(e=>(_(),r(d(M),{text:"",onClick:a=>(async e=>{var a,l;const t=await x({path:{id:e.id.toString()},query:{redirect_url:`${U.getWithoutQueryUrl()}?driver_id=${e.id}`}});if("error"===(null==(a=t.data)?void 0:a.status))return le.error(null==(l=t.data)?void 0:l.message);window.location.replace(t.data.data.redirect_url)})(e)},{icon:n((()=>[u(d(V),{component:d(U).getSocialiteIcon(e.provider)},null,8,["component"])])),default:n((()=>[c(" "+v(e.name),1)])),_:2},1032,["onClick"])))),256))])])):p("",!0)]})),_:1},8,["disabled","model"])]})),_:1},8,["title"]))]})),_:1},8,["header-title"]))}});export{W as default};
