import{g as e,u as a,n as t,f as l,_ as s,s as o}from"./Layout.vue_vue_type_script_setup_true_lang-Bd80f82b.js";import{_ as r}from"./Content.vue_vue_type_script_setup_true_lang-CEfikmAR.js";import{l as i}from"./album-dTOteY8-.js";import{k as u,c as n,K as c,L as d,Y as p,M as v,P as f,V as h,H as m,q as y,$ as g,r as _,a7 as b,N as x,U as w,F as k,R as P,Q as S,j as $,w as j,o as z,a8 as C,a6 as A}from"./vue-vendors-B4XdlKKZ.js";import{_ as L,a as T,b as U,c as q,d as R,e as D,f as M}from"./PhotoSelect.vue_vue_type_script_setup_true_lang-BkqGd2Lk.js";import{b as B,t as N,v as F,w as H,r as I,x as O}from"./index-DZdj2b_n.js";import{_ as G}from"./photo-components-DTzq5atJ.js";import{F as E}from"./icons-C1_zt0kT.js";import{J as K,N as Q,M as V,O as J,B as W,m as Y,P as X,o as Z,t as ee,Q as ae,y as te,A as le,K as se,I as oe}from"./naive-ui-DFBPfLe9.js";import{_ as re,a as ie}from"./Share.vue_vue_type_script_setup_true_lang-JcdndmeT.js";import{_ as ue}from"./Back.vue_vue_type_script_setup_true_lang-CZlTXmSD.js";import"./utils-DGAJShNI.js";const ne={class:"absolute inset-0 flex justify-between z-[2] select-none"},ce=u({__name:"PhotoBox",props:{photo:{},layout:{},layoutOptions:{},clickable:{type:Boolean},imageProps:{}},emits:["onToggleSelect"],setup(a,{emit:t}){const l=a,s=n((()=>{var e;return(null==(e=l.photo.srcSet)?void 0:e[0])??l.photo})),{toggleSelect:o}=e();return(e,a)=>(d(),c("div",{class:"relative group bg-gray-200 dark:bg-gray-700",onClick:a[1]||(a[1]=()=>p(o)(s.value.key))},[a[2]||(a[2]=v("div",{class:"transition-all absolute w-full top-0 h-1/2 bg-gradient-to-b from-black/30 opacity-0 group-hover:opacity-100"},null,-1)),v("div",ne,[f(p(E),{class:m(["rounded-full cursor-pointer absolute top-2 left-2",s.value.selected?"text-violet-500 bg-white outline outline-1 outline-white dark:outline-gray-500":"hidden group-hover:block text-white/70 hover:text-white"]),icon:"fa-solid fa-circle-check",size:"xl",onClick:a[0]||(a[0]=h((()=>p(o)(s.value.key)),["prevent","stop"]))},null,8,["class"])]),v("div",{class:m(["overflow-hidden transition-all",s.value.selected?"scale-90 rounded-lg":""])},[y(e.$slots,"default")],2)]))}}),de={class:"flex flex-col space-y-2"},pe={class:"sticky top-0 z-[3] py-2 bg-gray-50 dark:bg-[var(--n-color)] flex space-x-2 items-center overflow-hidden group text-md"},ve={class:"font-bold"},fe=u({__name:"PhotoSelectorGroup",props:{group:{type:Object,default:()=>{},required:!0}},setup(t){const l=t,{t:s}=g(),{toggleSelectAllByGroup:o}=e(),r=[s("Sunday"),s("Monday"),s("Tuesday"),s("Wednesday"),s("Thursday"),s("Friday"),s("Saturday")],i=_(4),u=_(180),n=e=>{let a;return a=e>=1200?12:e>=600&&e<1200?8:e>=300&&e<600?4:3,{maxPhotos:a,singleRowMaxHeight:220}};return(e,t)=>(d(),c("div",de,[v("div",pe,[f(p(E),{icon:l.group.selected?"fa-solid fa-circle-check":"fa-regular fa-circle",size:"xl",class:m(["transition-all select-none",l.group.selected?"text-violet-500 ml-0.5":"-ml-6 group-hover:ml-0.5 text-gray-500/70"]),onClick:t[0]||(t[0]=()=>p(o)(l.group.date))},null,8,["icon","class"]),v("p",ve,b(p(a)(l.group.date).format("L"))+" "+b(r[p(a)(l.group.date).day()]),1)]),f(p(G),{class:"gallery",layout:"rows",photos:l.group.photos,spacing:i.value,"photo-renderer":ce,"row-constraints":n,"target-row-height":u.value},null,8,["photos","spacing","target-row-height"])]))}}),he={key:1,class:"space-y-4"},me={key:2,class:"flex justify-center py-10"},ye=u({__name:"PhotoSelectorList",setup(a){const t=e();return(e,a)=>(d(),c(k,null,[p(t).isLoading||0!==p(t).groups.length?(d(),c("div",he,[(d(!0),c(k,null,P(p(t).groups,(e=>(d(),x(fe,{group:e},null,8,["group"])))),256))])):(d(),x(p(K),{key:0,class:"my-10",description:e.$t("No photos available")},null,8,["description"])),p(t).isLoading?(d(),c("div",me,[f(p(Q),{size:25})])):w("",!0)],64))}}),ge=u({__name:"PhotoSelector",props:{title:{type:String,required:!1,default:"Select Photos"}},emits:["onSelect"],setup(a,{expose:l,emit:s}){const{t:o}=g(),r=e(),i=a,u=s,n=_(!1);function c(){n.value=!1}function v(){u("onSelect",r.selections),c()}return l({open:function(){r.resetPhotos({q:"sort:latest"}),n.value=!0},close:c}),(e,a)=>(d(),x(p(V),{show:n.value,"onUpdate:show":a[0]||(a[0]=e=>n.value=e),placement:"bottom",height:"90%"},{default:S((()=>[f(p(J),{title:e.$t(i.title),"body-content-class":"!py-0 !px-2",closable:""},{footer:S((()=>[f(p(W),{secondary:"",strong:"",onClick:v},{default:S((()=>[$(b(e.$t("Selection Complete ({count})",{count:p(t).format(p(r).selections.length)})),1)])),_:1})])),default:S((()=>[f(ye)])),_:1},8,["title"])])),_:1},8,["show"]))}}),_e=u({__name:"PhotoRemove",props:{albumId:{type:Number,required:!0}},setup(e){const a=l(),t=B(),s=Y(),{t:o}=g(),r=e;function i(){N({path:{id:r.albumId},body:a.selections.map((e=>e.id))}).then((()=>{s.success(o("Removed successfully")),a.deletePhotos(a.selections.map((e=>e.key))),t.isLoggedIn&&t.fetchUserProfile()}))}return(e,t)=>(d(),x(p(X),{placement:"left-start",onPositiveClick:i},{trigger:S((()=>[f(p(W),{quaternary:"",circle:"",size:"small",type:"error",title:e.$t("Remove selected items from album")},{icon:S((()=>[f(p(E),{icon:"fa-regular fa-square-minus"})])),_:1},8,["title"])])),default:S((()=>[$(" "+b(e.$t("Are you sure you want to remove the selected {count} photos from the album?",{count:p(a).selections.length})),1)])),_:1}))}}),be={class:"flex items-center justify-between sticky top-0 z-[4] bg-gray-50 border-b border-transparent dark:bg-[var(--n-color)] dark:border-b-gray-800 p-2 w-full"},xe={class:"space-x-2"},we={class:"space-x-2"},ke={class:"flex flex-col"},Pe={class:"space-y-2 p-2 border-b dark:border-b-gray-600"},Se={class:"flex items-center p-2"},$e={class:"space-y-4 p-2"},je={class:"flex flex-col space-y-4"},ze={key:0,class:"flex justify-end"},Ce={key:1,class:"flex justify-between space-x-2"},Ae=u({__name:"DetailView",setup(e){const t=C(),u=A(),n=Y(),{t:h}=g(),m=_(!1),y=_(),w=_(),k=_(),P=_({}),B=l(),N=_(""),G=_({type:"photo",ids:[],content:"",password:"",expired_at:null}),K={},Q=e=>{const a=e.target;100+a.scrollTop+a.clientHeight>=a.scrollHeight&&(B.isLoading||(B.setPage(B.page+1),B.fetchPhotos()))};function V(){if(0===B.selections.length)return void n.warning(h("Please select photos first"));const e={...G.value};if(e.ids=B.selections.map((e=>e.id)),e.expired_at){const a=new Date(e.expired_at);e.expired_at=a.toISOString().slice(0,19).replace("T"," ")}I({body:e}).then((e=>{var a,t,l;if("error"===(null==(a=e.data)?void 0:a.status))return n.error(null==(t=e.data)?void 0:t.message);N.value=`${window.location.origin}/shares/${null==(l=e.data)?void 0:l.data.slug}`})).catch((()=>{n.error(h("Failed to create share"))}))}function J(){o.copyText(N.value).then((()=>{n.success(h("Copy successful"))})).catch((()=>{n.error(h("Copy failed"))}))}j((()=>B.shareModalActive),(e=>{e&&(N.value="",G.value={type:"photo",ids:[],content:"",password:"",expired_at:null})}));const X=i.debounce((()=>{F({path:{id:P.value.id},body:{name:P.value.name,intro:P.value.intro,is_public:P.value.is_public}})}),500);function ne(){var e;null==(e=y.value)||e.open()}function ce(){B.resetPhotos({q:"sort:latest",album_id:P.value.id})}function de(e){O({path:{id:P.value.id},body:e.map((e=>e.id))}).then((()=>{n.success(h("Added successfully")),ce()}))}return j((()=>P.value),(()=>{m.value&&X()}),{deep:!0}),z((()=>{var e;B.clearGroups(),H({path:{id:Number(null==(e=t.params)?void 0:e.id)}}).then((e=>{var a;P.value=null==(a=e.data)?void 0:a.data,setTimeout((()=>{m.value=!0,ce()}),50)}))})),(e,l)=>(d(),x(s,{"toggle-header":!1,"show-footer":!1,"header-title":e.$t("Album Details"),"content-class":"bg-white dark:bg-[var(--n-color)]","on-scroll":Q},{default:S((()=>[f(ge,{ref_key:"photoSelectorRef",ref:y,onOnSelect:de},null,512),f(re,{ref_key:"deleteRef",ref:w},null,512),f(ie,{ref_key:"shareRef",ref:k},null,512),f(r,{class:"max-w-full"},{default:S((()=>[v("div",be,[v("div",xe,[f(ue)]),v("div",we,[f(p(W),{tertiary:"",type:"error",onClick:l[0]||(l[0]=()=>{return e=P.value,void(null==(a=w.value)||a.open(e,(()=>{u.back(),n.success(h("Deleted successfully"))})));var e,a})},{icon:S((()=>[f(p(E),{icon:"fa-solid fa-trash",size:"sm"})])),_:1}),f(p(W),{tertiary:"",type:"default",onClick:l[1]||(l[1]=()=>{return e=P.value,void(null==(a=k.value)||a.open(e));var e,a})},{icon:S((()=>[f(p(E),{icon:"fa-solid fa-share",size:"sm"})])),_:1}),f(p(W),{secondary:"",onClick:ne},{icon:S((()=>[f(p(Z),null,{default:S((()=>[f(p(E),{icon:"fa-solid fa-plus",size:"sm"})])),_:1})])),default:S((()=>[$(" "+b(e.$t("Add Photos")),1)])),_:1})])]),v("div",ke,[v("div",Pe,[f(p(ee),{size:"large",value:P.value.name,"onUpdate:value":l[2]||(l[2]=e=>P.value.name=e),placeholder:e.$t("Add Title")},null,8,["value","placeholder"]),f(p(ee),{resizable:"",type:"textarea",value:P.value.intro,"onUpdate:value":l[3]||(l[3]=e=>P.value.intro=e),placeholder:e.$t("Add Description")},null,8,["value","placeholder"]),v("div",Se,b(p(a)(P.value.created_at).format("L"))+" - "+b(e.$t("{count} items",{count:P.value.photo_count})),1),f(p(ae),{value:P.value.is_public,"onUpdate:value":l[4]||(l[4]=e=>P.value.is_public=e),size:"large"},{checked:S((()=>[$(b(e.$t("Public")),1)])),unchecked:S((()=>[$(b(e.$t("Private")),1)])),_:1},8,["value"])]),v("div",$e,[f(L)]),f(T,null,{default:S((()=>{var e;return[f(U),f(q),f(R),f(D),f(ie),f(_e,{"album-id":Number(null==(e=p(t).params)?void 0:e.id)},null,8,["album-id"]),f(M)]})),_:1})])])),_:1}),f(p(oe),{show:p(B).shareModalActive,"onUpdate:show":l[8]||(l[8]=e=>p(B).shareModalActive=e),title:e.$t("Share Photos"),preset:"card",size:"small",bordered:!1,class:"max-w-screen-sm mx-4 md:mx-auto z-50"},{action:S((()=>[N.value?(d(),c("div",Ce,[f(p(ee),{class:"grow select-all","default-value":N.value,readonly:""},null,8,["default-value"]),f(p(W),{tertiary:"",type:"primary",class:"shrink-0",onClick:J},{icon:S((()=>[f(p(E),{icon:"fa-solid fa-copy"})])),_:1})])):(d(),c("div",ze,[f(p(W),{tertiary:"",onClick:V},{default:S((()=>[$(b(e.$t("Create Share Link")),1)])),_:1})]))])),default:S((()=>[v("div",je,[f(p(te),{model:G.value,rules:K,disabled:Boolean(N.value)},{default:S((()=>[f(p(le),{label:e.$t("Share Description"),path:"content"},{default:S((()=>[f(p(ee),{resizable:"",type:"textarea",value:G.value.content,"onUpdate:value":l[5]||(l[5]=e=>G.value.content=e)},null,8,["value"])])),_:1},8,["label"]),f(p(le),{label:e.$t("Password"),path:"password"},{default:S((()=>[f(p(ee),{type:"password",value:G.value.password,"onUpdate:value":l[6]||(l[6]=e=>G.value.password=e)},null,8,["value"])])),_:1},8,["label"]),f(p(le),{label:e.$t("Expiration Time"),path:"expired_at"},{default:S((()=>[f(p(se),{value:G.value.expired_at,"onUpdate:value":l[7]||(l[7]=e=>G.value.expired_at=e),type:"datetime",class:"w-full",placeholder:e.$t("Select Expiration Time"),"is-date-disabled":e=>e<Date.now(),clearable:""},null,8,["value","placeholder","is-date-disabled"])])),_:1},8,["label"])])),_:1},8,["model","disabled"])])])),_:1},8,["show","title"])])),_:1},8,["header-title"]))}});export{Ae as default};
