import{k as e,K as t,L as o,M as s,_ as a,$ as l,r as n,N as i,Q as r,Y as u,P as p,j as c,a7 as d,a6 as h,w as v,o as w,G as f,F as m,U as k,I as x,H as y,R as g,m as b,V as _,T as C,n as z}from"./vue-vendors-B4XdlKKZ.js";import{ac as U,ad as L,ae as j,af as q,ag as R,ah as $,u as B}from"./index-DZdj2b_n.js";import{m as I,I as E,A as S,t as M,y as O,B as A,o as P,S as Y,p as D}from"./naive-ui-DFBPfLe9.js";import{n as H,c as F,b as T}from"./Layout.vue_vue_type_script_setup_true_lang-Bd80f82b.js";const V={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},X=[s("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 368L144 144"},null,-1),s("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 144L144 368"},null,-1)],G=e({name:"CloseOutline",render:function(e,s){return o(),t("svg",V,X)}}),K={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},N=[s("path",{d:"M256 448a32 32 0 0 1-18-5.57c-78.59-53.35-112.62-89.93-131.39-112.8c-40-48.75-59.15-98.8-58.61-153C48.63 114.52 98.46 64 159.08 64c44.08 0 74.61 24.83 92.39 45.51a6 6 0 0 0 9.06 0C278.31 88.81 308.84 64 352.92 64c60.62 0 110.45 50.52 111.08 112.64c.54 54.21-18.63 104.26-58.61 153c-18.77 22.87-52.8 59.45-131.39 112.8a32 32 0 0 1-18 5.56z",fill:"currentColor"},null,-1)],Q=e({name:"Heart",render:function(e,s){return o(),t("svg",K,N)}}),W={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},J=[s("path",{d:"M352.92 80C288 80 256 144 256 144s-32-64-96.92-64c-52.76 0-94.54 44.14-95.08 96.81c-1.1 109.33 86.73 187.08 183 252.42a16 16 0 0 0 18 0c96.26-65.34 184.09-143.09 183-252.42c-.54-52.67-42.32-96.81-95.08-96.81z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)],Z=e({name:"HeartOutline",render:function(e,s){return o(),t("svg",W,J)}}),ee=a("explore",(()=>({photoLiked:async function(e){return await U({path:{id:e}})},photoUnlinked:async function(e){return await L({path:{id:e}})}}))),te={class:"flex flex-col space-y-4"},oe={class:"flex justify-end"},se=e({__name:"Report",props:{type:{type:String,required:!0}},setup(e,{expose:t}){const{t:a}=l(),h=e,v={album:a("Album"),photo:a("Photo"),user:a("User"),share:a("Share")},w=I(),f=n(!1),m=n(),k=n({content:""}),x={},y=n({});async function g(){var e,t;const o={photo:$,album:R,user:q,share:j},s=await o[h.type]({body:{content:k.value.content},...y.value});if("error"===(null==(e=s.data)?void 0:e.status))return w.error(null==(t=s.data)?void 0:t.message);w.success(a("Report submitted successfully. Thank you for your feedback!")),b()}function b(){f.value=!1}return t({open:function(e){y.value=e,f.value=!0},close:b}),(t,a)=>(o(),i(u(E),{show:f.value,"onUpdate:show":a[1]||(a[1]=e=>f.value=e),title:`举报${v[e.type]}`,preset:"card",size:"small",bordered:!1,class:"max-w-screen-sm mx-4 md:mx-auto"},{action:r((()=>[s("div",oe,[p(u(A),{tertiary:"",onClick:g},{default:r((()=>[c(d(t.$t("Confirm Report")),1)])),_:1})])])),default:r((()=>[s("div",te,[p(u(O),{ref_key:"reportFormRef",ref:m,model:k.value,rules:x},{default:r((()=>[p(u(S),{label:t.$t("Please describe the reason for reporting"),path:"content"},{default:r((()=>[p(u(M),{resizable:"",type:"textarea",value:k.value.content,"onUpdate:value":a[0]||(a[0]=e=>k.value.content=e)},null,8,["value"])])),_:1},8,["label"])])),_:1},8,["model"])])])),_:1},8,["show","title"]))}}),ae={key:0,class:"photo-viewer"},le=["src","alt"],ne={key:0,class:"photo-viewer-loading"},ie={class:"photo-viewer-info-left"},re={class:"space-y-1"},ue={class:"text-white text-sm font-medium"},pe={class:"text-white/80 text-xs"},ce={key:0,class:"flex gap-1 flex-wrap"},de={key:0,class:"text-xs text-white/70"},he={class:"photo-viewer-info-right"},ve={key:0,class:"flex items-center space-x-3"},we={class:"text-white text-sm"},fe={class:"flex items-center space-x-2"},me=T(e({__name:"PhotoViewer",props:{photo:{type:Object,required:!0,default:()=>{}},show:{type:Boolean,required:!0,default:!1},showUserInfo:{type:Boolean,required:!1,default:()=>!0},showLike:{type:Boolean,required:!1,default:()=>!0},showReport:{type:Boolean,required:!1,default:()=>!0}},emits:["update:show"],setup(e,{emit:a}){const l=e,U=a,L=ee(),j=h(),q=B(),R=n(null),$=n(),I=n(),E=n(1),S=n(0),M=n(0),O=n(!1),T=n({x:0,y:0}),V=n(!1);function X(){l.photo.is_liked?(L.photoUnlinked(l.photo.id),l.photo.is_liked=!1):(L.photoLiked(l.photo.id),l.photo.is_liked=!0)}function K(){var e;null==(e=R.value)||e.open({path:{id:l.photo.id}})}function N(){j.push(`/explore/@${l.photo.user.username}`).then((()=>q.setSidebarOpen(!1)))}function W(){U("update:show",!1)}function J(){V.value=!0}function te(e){e.preventDefault();const t=e.deltaY>0?-.1:.1,o=Math.max(.1,Math.min(5,E.value+t));E.value=o}function oe(e){E.value<=1||(O.value=!0,T.value={x:e.clientX-S.value,y:e.clientY-M.value},e.preventDefault())}function me(e){!O.value||E.value<=1||(S.value=e.clientX-T.value.x,M.value=e.clientY-T.value.y)}function ke(){O.value=!1}function xe(){1===E.value?E.value=2:(E.value=1,S.value=0,M.value=0)}function ye(e){l.show&&"Escape"===e.key&&W()}return v((()=>l.show),(e=>{e?(E.value=1,S.value=0,M.value=0,V.value=!1,z((()=>{document.body.style.overflow="hidden"}))):document.body.style.overflow=""})),w((()=>{document.addEventListener("keydown",ye),document.addEventListener("mousemove",me),document.addEventListener("mouseup",ke)})),f((()=>{document.removeEventListener("keydown",ye),document.removeEventListener("mousemove",me),document.removeEventListener("mouseup",ke),document.body.style.overflow=""})),(a,n)=>(o(),t(m,null,[(o(),i(C,{to:"body"},[e.show?(o(),t("div",ae,[s("div",{class:"photo-viewer-backdrop",onClick:W}),s("div",{class:"photo-viewer-bg",style:x({backgroundImage:`url(${l.photo.public_url})`})},null,4),s("button",{class:"photo-viewer-close",onClick:W},[p(u(P),{component:u(G),size:"24"},null,8,["component"])]),s("div",{ref_key:"containerRef",ref:I,class:"photo-viewer-container",onWheel:te},[s("img",{ref_key:"imageRef",ref:$,src:l.photo.public_url,alt:l.photo.name,class:y(["photo-viewer-image",{"cursor-grab":E.value>1&&!O.value,"cursor-grabbing":O.value}]),style:x({transform:`scale(${E.value}) translate(${S.value/E.value}px, ${M.value/E.value}px)`,opacity:V.value?1:0}),onLoad:J,onMousedown:oe,onDblclick:xe,draggable:"false"},null,46,le),V.value?k("",!0):(o(),t("div",ne,n[2]||(n[2]=[s("div",{class:"loading-spinner"},null,-1)])))],544),s("div",{class:"photo-viewer-info",onClick:n[0]||(n[0]=_((()=>{}),["stop"]))},[s("div",ie,[s("div",re,[s("div",ue,d(l.photo.name||"Untitled"),1),s("div",pe,d((l.photo.extension||"Unknown").toUpperCase())+" • "+d(l.photo.width||0)+" × "+d(l.photo.height||0)+" • "+d(u(H).fileSize(l.photo.size||0)),1),l.photo.tags&&l.photo.tags.length>0?(o(),t("div",ce,[(o(!0),t(m,null,g(l.photo.tags.slice(0,3),(e=>(o(),i(u(Y),{key:e.id,size:"small",bordered:!1,class:"bg-white/20 text-white"},{default:r((()=>[c(d(e.name),1)])),_:2},1024)))),128)),l.photo.tags.length>3?(o(),t("span",de,"+"+d(l.photo.tags.length-3),1)):k("",!0)])):k("",!0)])]),s("div",he,[l.showUserInfo?(o(),t("div",ve,[s("div",{class:"flex items-center space-x-2 cursor-pointer",onClick:N},[p(u(D),{round:"",size:32,src:u(F).getUserAvatar(l.photo.user.avatar_url)},null,8,["src"]),s("span",we,d(l.photo.user.name),1)])])):k("",!0),s("div",fe,[l.showLike?(o(),i(u(A),{key:0,quaternary:"",size:"small",type:l.photo.is_liked?"error":"default","render-icon":()=>b(u(P),{size:16},{default:()=>b(l.photo.is_liked?u(Q):u(Z))}),onClick:X,class:"text-white border-white/30 hover:bg-white/10"},{default:r((()=>[c(d(a.$t("Like")),1)])),_:1},8,["type","render-icon"])):k("",!0),l.showReport?(o(),i(u(A),{key:1,quaternary:"",size:"small",onClick:K,class:"text-white border-white/30 hover:bg-white/10"},{default:r((()=>[c(d(a.$t("Report")),1)])),_:1})):k("",!0)])])]),1===E.value?(o(),t("div",{key:0,class:"photo-viewer-hint",onClick:n[1]||(n[1]=_((()=>{}),["stop"]))},n[3]||(n[3]=[s("span",{class:"text-white/60 text-xs"},"滚轮缩放 • 双击放大 • ESC关闭",-1)]))):k("",!0)])):k("",!0)])),(o(),i(C,{to:"body"},[p(se,{ref_key:"reportRef",ref:R,type:"photo"},null,512)]))],64))}}),[["__scopeId","data-v-17234120"]]),ke=["src","alt"],xe={class:"absolute bottom-0 left-0 right-0 opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-white"},ye={class:"bg-gradient-to-t from-black via-black/80 to-transparent p-2 space-y-1"},ge={class:"text-xs font-medium truncate"},be={class:"text-xs opacity-90"},_e={class:"sm:hidden space-y-0.5"},Ce={class:"hidden sm:block truncate"},ze={key:0,class:"flex gap-1 flex-wrap"},Ue={key:0,class:"text-xs opacity-70"},Le={class:"flex items-center justify-between space-x-2 pt-1"},je={key:0,class:"flex items-center min-w-0 flex-1"},qe={class:"ml-2 min-w-0"},Re={key:1,class:"shrink-0"},$e={class:"text-white text-xs hidden sm:inline"},Be=e({__name:"ExploreImage",props:{photo:{type:Object,required:!0,default:()=>{}},showUserInfo:{type:Boolean,required:!1,default:()=>!0},showLike:{type:Boolean,required:!1,default:()=>!0},showReport:{type:Boolean,required:!1,default:()=>!0}},setup(e){const a=e,l=n(!1),i=ee(),c=h(),v=B();function w(){a.photo.is_liked?(i.photoUnlinked(a.photo.id),a.photo.is_liked=!1):(i.photoLiked(a.photo.id),a.photo.is_liked=!0)}function f(){c.push(`/explore/@${a.photo.user.username}`).then((()=>v.setSidebarOpen(!1)))}return(e,n)=>(o(),t(m,null,[s("div",{class:"relative group overflow-hidden w-full cursor-zoom-in bg-gray-200 dark:bg-gray-800",onClick:n[0]||(n[0]=e=>l.value=!0)},[s("img",{src:a.photo.thumbnail_url,alt:a.photo.name,class:"w-full h-auto transition-transform duration-300 group-hover:scale-105",loading:"lazy"},null,8,ke),n[2]||(n[2]=s("div",{class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300"},null,-1)),s("div",xe,[s("div",ye,[s("div",ge,d(a.photo.name||"Untitled"),1),s("div",be,[s("div",_e,[s("div",null,d((a.photo.extension||"Unknown").toUpperCase()),1),s("div",null,d(a.photo.width||0)+" × "+d(a.photo.height||0),1),s("div",null,d(u(H).fileSize(a.photo.size||0)),1)]),s("div",Ce,d((a.photo.extension||"Unknown").toUpperCase())+" • "+d(a.photo.width||0)+" × "+d(a.photo.height||0)+" • "+d(u(H).fileSize(a.photo.size||0)),1)]),a.photo.tags&&a.photo.tags.length>0?(o(),t("div",ze,[(o(!0),t(m,null,g(a.photo.tags.slice(0,2),(e=>(o(),t("span",{key:e.id,class:"bg-white bg-opacity-20 rounded px-1 text-xs max-w-16 truncate"},d(e.name),1)))),128)),a.photo.tags.length>2?(o(),t("span",Ue,"+"+d(a.photo.tags.length-2),1)):k("",!0)])):k("",!0),s("div",Le,[a.showUserInfo?(o(),t("div",je,[p(u(D),{class:"shrink-0 cursor-pointer z-10",round:"",size:16,src:u(F).getUserAvatar(a.photo.user.avatar_url),onClick:_(f,["stop"])},null,8,["src"]),s("div",qe,[s("a",{href:"javascript:void(0)",onClick:_(f,["stop"]),class:"text-white text-xs truncate block hover:text-gray-200"},d(a.photo.user.name),1)])])):k("",!0),a.showLike?(o(),t("div",Re,[p(u(A),{quaternary:"",size:"tiny",class:"z-10 relative",type:a.photo.is_liked?"error":"default","render-icon":()=>b(u(P),{size:12},{default:()=>b(a.photo.is_liked?u(Q):u(Z))}),onClick:_(w,["stop"])},{default:r((()=>[s("span",$e,d(e.$t("Like")),1)])),_:1},8,["type","render-icon"])])):k("",!0)])])])]),p(me,{show:l.value,"onUpdate:show":n[1]||(n[1]=e=>l.value=e),photo:a.photo,"show-user-info":a.showUserInfo,"show-like":a.showLike,"show-report":a.showReport},null,8,["show","photo","show-user-info","show-like","show-report"])],64))}});export{se as _,Be as a};
