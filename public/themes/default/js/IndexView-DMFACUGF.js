import{_ as e,k as t,$ as s,r as a,m as r,a6 as i,N as o,Q as n,P as l,Y as u,M as c,j as d,a7 as m,a9 as p,L as f}from"./vue-vendors-B4XdlKKZ.js";import{_}from"./Content.vue_vue_type_script_setup_true_lang-CEfikmAR.js";import{u as v,_ as k,S as y}from"./Layout.vue_vue_type_script_setup_true_lang-Bd80f82b.js";import{N as h,O as g}from"./index-DZdj2b_n.js";import{_ as w}from"./DataTable.vue_vue_type_script_setup_true_lang-Dzev82sr.js";import{m as T,G as C,S as j,T as x,B as $,r as b,o as P,t as W}from"./naive-ui-DFBPfLe9.js";import{P as L}from"./icons-C1_zt0kT.js";import"./photo-components-DTzq5atJ.js";import"./utils-DGAJShNI.js";const U=e("ticket",(()=>({closeTicket:async function(e,t,s,a,r={}){return new Promise((i=>{const o=s.warning({title:a("Close Ticket"),content:a("Once closed, you cannot reply to the ticket. Are you sure you want to close this ticket?"),positiveText:a("Confirm"),negativeText:a("Cancel"),onPositiveClick:()=>(o.loading=!0,new Promise((s=>{h({path:{issue_no:e}}).then((()=>{t.success(a("Closed successfully")),s(!0)})).finally((()=>{o.loading=!1,i(!0)}))}))),...r})}))}}))),S={class:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between"},z={class:"grow md:grow-0 md:basis-1/2"},A=t({__name:"IndexView",setup(e){const t=U(),h=i(),{t:A}=s(),K=T(),M=C(),N=a(),q=[{title:A("Ticket Number"),key:"issue_no",minWidth:250},{title:A("Ticket Title"),key:"title",minWidth:300},{title:A("Ticket Level"),key:"level",minWidth:120,sorter:!0,align:"center",render(e){const t={low:A("Low"),medium:A("Medium"),high:A("High")},s=e.level;return r(j,{type:{low:"info",medium:"warning",high:"danger"}[s]},{default:()=>t[s]||A("Unknown")})}},{title:A("Ticket Status"),key:"status",minWidth:100,sorter:!0,align:"center",render(e){const t={in_progress:A("Processing"),completed:A("Completed")},s=e.status;return r(j,{type:{in_progress:"warning",completed:"success"}[s]},{default:()=>t[s]??A("Unknown")})}},{title:A("Creation Time"),minWidth:200,key:"created_at",sorter:!0,align:"center",render:e=>v(e.created_at).format("L")},{title:A("Actions"),key:"actions",minWidth:170,fixed:"right",align:"center",render:e=>r(x,{vertical:!1,size:5,justify:"center"},{default:()=>[r($,{size:"small",onClick:()=>{h.push(`/user/tickets/${e.issue_no}`)}},{default:()=>A("Details")}),r($,{disabled:"completed"===e.status,size:"small",type:"error",onClick:()=>{t.closeTicket(e.issue_no,K,M,A).finally((()=>{var e;O.value=[],null==(e=N.value)||e.refresh()}))}},{default:()=>A("Close Ticket")})]})}],D=a(""),I=a("sort:latest"),O=a([]),R=e=>g({query:{page:e,per_page:40,q:`${D.value} ${I.value}`.trim()}});function B(e){var t;e.order?I.value=`sort:${e.columnKey}:${e.order}`:I.value="sort:latest",null==(t=N.value)||t.refresh()}function E(){var e;null==(e=N.value)||e.refresh()}return(e,t)=>(f(),o(k,{"header-title":e.$t("My Tickets"),"toggle-header":!1,"show-footer":!1},{default:n((()=>[l(_,{class:"mx-auto p-4 md:p-10 space-y-10"},{default:n((()=>[l(u(b),null,{default:n((()=>[l(u(x),{vertical:""},{default:n((()=>[c("div",S,[c("div",null,[l(u($),{tertiary:"",onClick:t[0]||(t[0]=()=>{u(h).push("/user/tickets/create")})},{icon:n((()=>[l(u(P),{component:u(L)},null,8,["component"])])),default:n((()=>[d(" "+m(e.$t("Create Ticket")),1)])),_:1})]),c("div",z,[l(u(W),{value:D.value,"onUpdate:value":t[1]||(t[1]=e=>D.value=e),placeholder:e.$t("Enter keywords to search..."),onKeyup:p(E,["enter","native"])},{prefix:n((()=>[l(u(P),{component:u(y)},null,8,["component"])])),_:1},8,["value","placeholder"])])]),l(w,{striped:"",ref_key:"tableRef",ref:N,bordered:!1,fetch:R,columns:q,"row-key":e=>e.id,"checked-row-keys":O.value,"onUpdate:checkedRowKeys":t[2]||(t[2]=e=>O.value=e),onUpdateSorter:B},null,8,["row-key","checked-row-keys"])])),_:1})])),_:1})])),_:1})])),_:1},8,["header-title"]))}});export{A as default};
