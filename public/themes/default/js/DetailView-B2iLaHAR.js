import{_ as e,n as a,b as s}from"./Layout.vue_vue_type_script_setup_true_lang-Bd80f82b.js";import{_ as l}from"./Content.vue_vue_type_script_setup_true_lang-CEfikmAR.js";import{_ as t}from"./Back.vue_vue_type_script_setup_true_lang-CZlTXmSD.js";import{a as r,F as i,G as n,H as o,I as u}from"./index-DZdj2b_n.js";import{k as c,r as d,$ as p,c as v,w as m,o as f,a8 as y,N as b,Q as _,P as g,Y as x,M as h,U as k,a7 as w,j as $,K as j,R as C,F as P,a6 as S,L as N,H as O}from"./vue-vendors-B4XdlKKZ.js";import{u as U}from"./order-B5wF1C3c.js";import{u as z,_ as A}from"./usePayment-uvCoKVRE.js";import{G as B,f as D,d as H}from"./icons-C1_zt0kT.js";import{m as I,N as F,U as G,v as K,r as L,o as M,s as V,t as E,B as J,V as Q,W as R}from"./naive-ui-DFBPfLe9.js";import"./photo-components-DTzq5atJ.js";import"./utils-DGAJShNI.js";const T={class:"flex flex-col w-full space-y-4"},W={class:"flex items-center justify-between"},Y={class:"bg-gradient-to-r from-green-50 to-blue-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-6 mb-4"},q={class:"text-2xl md:text-3xl font-bold mb-2 dark:text-white"},X={class:"text-gray-600 dark:text-gray-300"},Z={class:"flex w-full flex-col md:flex-row gap-6"},ee={class:"w-full md:basis-2/3 space-y-6"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},se={class:"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-green-100 dark:bg-green-900"},le=["title"],te={class:"payment-options"},re=["onClick"],ie={class:"select-indicator"},ne={class:"radio-outer"},oe={key:0,class:"radio-inner"},ue={class:"option-content"},ce={class:"option-header"},de={class:"flex items-center"},pe={class:"option-name"},ve={key:0,class:"best-value-badge"},me={key:0,class:"selected-badge"},fe={class:"option-price"},ye={key:0,class:"option-description"},be={key:1,class:"option-features"},_e={class:"flex flex-col gap-4 w-full md:basis-1/3"},ge={class:"font-medium mb-3 flex items-center gap-2"},xe={class:"flex flex-col space-y-4"},he={class:"flex justify-between items-center"},ke={class:"text-gray-600 dark:text-gray-400"},we={class:"flex justify-between items-center"},$e={class:"text-gray-600 dark:text-gray-400"},je={key:0,class:"flex justify-between items-center text-green-600"},Ce={class:"flex items-center gap-2"},Pe={class:"flex justify-between items-center"},Se={class:"font-bold"},Ne=s(c({__name:"DetailView",setup(s){const c=y(),Ne=S(),Oe=I(),Ue=r(),ze=i(),Ae=d({}),Be=d({}),De=d(""),He=d(""),Ie=d(0),Fe=d(0);U();const{t:Ge}=p(),Ke=d(!1),{handlePayment:Le,validatePayment:Me}=z(),Ve=v((()=>Ie.value)),Ee=v((()=>{var e;return Fe.value&&"number"==typeof(null==(e=Be.value)?void 0:e.price)?0===Be.value.price||Fe.value>=Be.value.price?100:Math.round(Fe.value/Be.value.price*100):0}));async function Je(){var e,a,s,l;Ke.value=!0;try{const t=await o({body:{price_id:Be.value.id,coupon_code:He.value}});if("error"===(null==(e=t.data)?void 0:e.status))return Oe.error(null==(a=t.data)?void 0:a.message);Ie.value=(null==(s=t.data)?void 0:s.data.amount)||0,Fe.value=(null==(l=t.data)?void 0:l.data.deduct_amount)||0}catch(t){}finally{Ke.value=!1}}async function Qe(){var e,a,s;if(Me(De.value,Ie.value)){Ke.value=!0;try{const l=await u({body:{price_id:Be.value.id,coupon_code:He.value}});if("error"===(null==(e=l.data)?void 0:e.status))return Oe.error(null==(a=l.data)?void 0:a.message);const t=l.data.data.trade_no;(null==(s=l.data)?void 0:s.data.is_paid)?Ne.push(`/user/orders/${t}`).then((()=>{Oe.success(Ge("Order Payment Successful"))})):await Le(De.value,t)}catch(l){Oe.error(Ge("Order creation failed"))}finally{Ke.value=!1}}}return m(Be,(()=>Je()),{deep:!0}),f((async()=>{var e,a,s,l;Ke.value=!0;try{const t=await n({path:{id:Number(c.params.id)}});if("error"===(null==(e=t.data)?void 0:e.status))return Oe.error(null==(a=t.data)?void 0:a.message);Ae.value=null==(s=t.data)?void 0:s.data,Be.value=null==(l=t.data)?void 0:l.data.prices[0],await Je()}catch(t){}finally{Ke.value=!1}})),(s,r)=>(N(),b(e,{"header-title":s.$t("Subscription Details"),"toggle-header":!1,"show-footer":!1},{default:_((()=>[g(l,{class:"mx-auto p-4 md:p-10 space-y-6"},{default:_((()=>[g(x(F),{show:Ke.value},{default:_((()=>[h("div",T,[h("div",W,[g(t,{to:"/user/plans",class:"hover:text-primary transition-colors"}),Ae.value.badge?(N(),b(x(G),{key:0,value:Ae.value.badge,type:"success"},null,8,["value"])):k("",!0)]),h("div",Y,[h("h1",q,w(Ae.value.name),1),h("p",X,w(Ae.value.intro),1)]),g(x(K),{type:"info","show-icon":"",class:"mb-4"},{default:_((()=>[$(w(s.$t("Note that subscription purchases do not stack packages, only one subscription will be in effect at any one time, and the most recently purchased subscription will be applied immediately upon successful purchase.")),1)])),_:1}),h("div",Z,[h("div",ee,[g(x(L),{title:s.$t("Subscription Information"),class:"subscription-card",bordered:!1},{default:_((()=>[h("div",ae,[(N(!0),j(P,null,C(Ae.value.features,(e=>(N(),j("div",{key:e,class:"flex space-x-2 items-center"},[h("div",se,[g(x(M),{size:14,color:"#18a058",component:x(H)},null,8,["component"])]),h("p",{class:"w-full",title:e},w(e),9,le)])))),128))])])),_:1},8,["title"]),g(x(L),{title:s.$t("Payment Cycle"),class:"subscription-card",bordered:!1},{default:_((()=>[h("div",te,[(N(!0),j(P,null,C(Ae.value.prices,(e=>{var l;return N(),j("div",{key:e.id,class:O(["payment-option",{"payment-option-selected":e.id===Be.value.id},{"payment-option-recommended":e.recommended}]),onClick:a=>Be.value=e},[h("div",ie,[h("div",ne,[e.id===Be.value.id?(N(),j("div",oe)):k("",!0)])]),h("div",ue,[h("div",ce,[h("div",de,[h("span",pe,w(e.name),1),e.recommended?(N(),j("span",ve,w(s.$t("Best value")),1)):k("",!0)]),e.id===Be.value.id?(N(),j("div",me,w(s.$t("Selected")),1)):k("",!0)]),h("div",fe,w(x(a).currency(e.price,null==(l=x(Ue).configs)?void 0:l.app.currency,x(ze).locale)),1),e.description?(N(),j("div",ye,w(e.description),1)):k("",!0),e.features&&e.features.length>0?(N(),j("div",be,[(N(!0),j(P,null,C(e.features,((e,a)=>(N(),j("div",{key:a,class:"feature-item"},[r[3]||(r[3]=h("div",{class:"feature-dot"},null,-1)),h("span",null,w(e),1)])))),128))])):k("",!0)])],10,re)})),128))])])),_:1},8,["title"])]),h("div",_e,[g(x(L),{class:"subscription-card",bordered:!1},{default:_((()=>[h("h3",ge,[g(x(M),{component:x(B)},null,8,["component"]),h("span",null,w(s.$t("Apply Coupon")),1)]),g(x(V),null,{default:_((()=>[g(x(E),{value:He.value,"onUpdate:value":r[0]||(r[0]=e=>He.value=e),placeholder:s.$t("Enter coupon code")},null,8,["value","placeholder"]),g(x(J),{type:"primary",disabled:!He.value,onClick:r[1]||(r[1]=()=>{He.value&&Je()})},{default:_((()=>[$(w(s.$t("Apply")),1)])),_:1},8,["disabled"])])),_:1})])),_:1}),g(x(L),{title:s.$t("Order Summary"),class:"subscription-card checkout-card",bordered:!1},{default:_((()=>{var e;return[h("div",xe,[h("div",he,[h("span",ke,w(s.$t("Subscription")),1),h("span",null,w(Ae.value.name),1)]),h("div",we,[h("span",$e,w(s.$t("Plan")),1),h("span",null,w(Be.value.name),1)]),Fe.value>0?(N(),j("div",je,[h("span",null,w(s.$t("Coupon Discount")),1),h("div",Ce,[h("span",null,"-"+w(x(a).currency(Fe.value,null==(e=x(Ue).configs)?void 0:e.app.currency,x(ze).locale)),1),Ee.value>0&&Ee.value<=100?(N(),b(x(G),{key:0,value:`-${Ee.value}%`,type:"success"},null,8,["value"])):k("",!0)])])):k("",!0),g(x(Q)),h("div",Pe,[h("span",Se,w(s.$t("Total")),1),g(x(R),{value:Ve.value,class:"text-2xl font-bold",style:{color:"#e53e3e"}},{prefix:_((()=>{var e;return[$(w(null==(e=x(Ue).configs)?void 0:e.app.currency),1)]})),_:1},8,["value"])]),Ie.value>0?(N(),j(P,{key:1},[g(A,{value:De.value,"onUpdate:value":r[2]||(r[2]=e=>De.value=e),class:"mt-2"},null,8,["value"]),g(x(J),{type:"primary",size:"large",block:"",disabled:""===De.value,onClick:Qe,class:"mt-4"},{icon:_((()=>[g(x(M),{component:x(D)},null,8,["component"])])),default:_((()=>[$(" "+w(s.$t("Complete Purchase")),1)])),_:1},8,["disabled"])],64)):(N(),b(x(J),{key:2,type:"primary",size:"large",block:"",onClick:Qe,class:"mt-4"},{default:_((()=>[$(w(s.$t("Confirm Order")),1)])),_:1}))])]})),_:1},8,["title"])])])])])),_:1},8,["show"])])),_:1})])),_:1},8,["header-title"]))}}),[["__scopeId","data-v-0898b0b5"]]);export{Ne as default};
