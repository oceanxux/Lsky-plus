import{_ as e}from"./Content.vue_vue_type_script_setup_true_lang-CEfikmAR.js";import{f as l,n as a,_ as t,s}from"./Layout.vue_vue_type_script_setup_true_lang-Bd80f82b.js";import{u as o,l as r}from"./album-dTOteY8-.js";import{_ as i,a as n,b as d,c as u,d as c,e as p,f as v}from"./PhotoSelect.vue_vue_type_script_setup_true_lang-BkqGd2Lk.js";import{F as f}from"./icons-C1_zt0kT.js";import{a as m,r as h}from"./index-DZdj2b_n.js";import{k as b,$ as y,r as g,w as _,N as w,Y as x,Q as k,M as S,U as $,P as A,K as j,F as P,R as C,L,a7 as U,o as z,b as q,j as T}from"./vue-vendors-B4XdlKKZ.js";import{I as E,t as F,J as M,q as D,N as K,m as N,B as I,C as O,y as R,A as B,K as H}from"./naive-ui-DFBPfLe9.js";import"./photo-components-DTzq5atJ.js";import"./utils-DGAJShNI.js";const J={class:"flex flex-col space-y-4"},Q={class:"flex justify-between w-full border-b pb-2 dark:border-b-gray-600"},V=["onClick"],Y={class:"h-16 w-16 rounded-lg overflow-hidden shrink-0"},G=["src"],W={key:1,class:"flex grow items-center justify-center h-full bg-gray-100 dark:bg-gray-700"},X={class:"flex flex-col justify-center ml-4 overflow-hidden"},Z={key:0,class:"truncate text-lg"},ee={class:"truncate text-gray-500"},le={key:0,class:"flex justify-center py-10"},ae=b({__name:"AlbumSelector",props:{title:{type:String,required:!1,default:"Select Album"}},emits:["onSelect"],setup(e,{expose:l,emit:a}){const t=o(),{t:s}=y(),i=e,n=a,d=g(!1),u=g("");function c(){d.value=!1}function p(){t.isLoading||(t.setPage(t.page+1),t.fetchAlbums())}return _((()=>u.value),r.debounce((()=>{t.resetAlbums({q:u})}),500)),l({open:function(){t.resetAlbums(),d.value=!0},close:c}),(e,l)=>(L(),w(x(E),{show:d.value,"onUpdate:show":l[1]||(l[1]=e=>d.value=e),title:i.title,preset:"card",size:"small",bordered:!1,class:"container m-4 md:mx-auto md:my-10 max-w-screen-md overflow-hidden"},{default:k((()=>[S("div",J,[S("div",Q,[A(x(F),{placeholder:e.$t("Search Albums"),bordered:!1,value:u.value,"onUpdate:value":l[0]||(l[0]=e=>u.value=e)},null,8,["placeholder","value"])]),x(t).isLoading||0!==x(t).albums.length?$("",!0):(L(),w(x(M),{key:0,class:"py-8",description:e.$t("No albums available")},null,8,["description"])),A(x(D),{class:"max-h-[400px]",onLoad:p},{default:k((()=>[(L(!0),j(P,null,C(x(t).albums,(l=>(L(),j("div",{class:"flex p-2 mb-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800",onClick:e=>function(e){var l;t.toggleSelect((null==(l=e.id)?void 0:l.toString())||""),n("onSelect",t.selections),c()}(l)},[S("div",Y,[l.covers&&l.covers.length>0?(L(),j("img",{key:0,class:"rounded-lg w-full h-full object-cover",alt:"album cover",src:l.covers[0]},null,8,G)):(L(),j("div",W,[A(x(f),{icon:"fa-solid fa-images",class:"text-gray-500",size:"xl"})]))]),S("div",X,[l.name?(L(),j("div",Z,U(l.name),1)):$("",!0),S("div",ee,U(e.$t("{count} items",{count:l.photo_count})),1)])],8,V)))),256)),x(t).isLoading?(L(),j("div",le,[A(x(K),{size:25})])):$("",!0)])),_:1})])])),_:1},8,["show","title"]))}}),te=b({__name:"PhotoToAlbum",setup(e){const a=l(),t=g(null),s=N(),{t:o}=y();function r(){var e;null==(e=t.value)||e.open()}function i(e){a.selectedToAlbum(e).then((()=>{s.success(o("Added successfully"))})).catch((e=>{s.error(o("Failed to add to album"))}))}return z((()=>{a.setAlbumSelectorRef(t.value)})),(e,l)=>(L(),j(P,null,[A(ae,{ref_key:"albumSelectorRef",ref:t,title:e.$t("Add to Album"),onOnSelect:i},null,8,["title"]),A(x(I),{tertiary:"",circle:"",size:"small",type:"default",title:e.$t("Add to Album"),onClick:r},{icon:k((()=>[A(x(f),{icon:"fa-solid fa-plus"})])),_:1},8,["title"])],64))}}),se=b({__name:"PhotoShare",setup(e){const{t:a}=y(),t=l();return(e,l)=>(L(),w(x(I),{tertiary:"",circle:"",size:"small",type:"default",title:e.$t("Share"),onClick:l[0]||(l[0]=e=>x(t).setShareModalActive(!0))},{icon:k((()=>[A(x(f),{icon:"fa-solid fa-share-nodes"})])),_:1},8,["title"]))}}),oe={class:"flex items-center justify-between space-x-2 sticky top-0 z-[4] bg-gray-100 border-b border-transparent dark:bg-[var(--n-color)] dark:border-b-gray-800 p-2 w-full"},re={class:"flex justify-end space-x-2 grow md:grow-0 md:w-2/3"},ie={class:"flex flex-col"},ne={class:"space-y-4 p-2"},de={class:"flex flex-col space-y-4"},ue={key:0,class:"flex justify-end"},ce={key:1,class:"flex justify-between space-x-2"},pe=b({__name:"IndexView",setup(o){const b=m(),$=l(),{t:P}=y(),C=N(),M=g(""),D=g({type:"photo",ids:[],content:"",password:"",expired_at:null}),K={},J=e=>{const l=e.target;100+l.scrollTop+l.clientHeight>=l.scrollHeight&&($.isLoading||($.setPage($.page+1),$.fetchPhotos()))};function Q(e){(e.ctrlKey||e.metaKey)&&"a"===e.key&&(e.preventDefault(),$.selectAll())}const V=[{label:P("Newest"),value:"latest"},{label:P("Oldest"),value:"oldest"}],Y=g({q:"",storage_id:null,order_by:"latest"});function G(){$.resetPhotos({storage_id:Y.value.storage_id,q:`sort:${Y.value.order_by} ${Y.value.q}`})}function W(){if(0===$.selections.length)return void C.warning(P("Please select photos first"));const e={...D.value};if(e.ids=$.selections.map((e=>e.id)),e.expired_at){const l=new Date(e.expired_at);e.expired_at=l.toISOString().slice(0,19).replace("T"," ")}h({body:e}).then((e=>{var l,a,t;if("error"===(null==(l=e.data)?void 0:l.status))return C.error(null==(a=e.data)?void 0:a.message);M.value=`${window.location.origin}/shares/${null==(t=e.data)?void 0:t.data.slug}`})).catch((()=>{C.error(P("Failed to create share"))}))}function X(){s.copyText(M.value).then((()=>{C.success(P("Copy successful"))})).catch((()=>{C.error(P("Copy failed"))}))}return _((()=>$.shareModalActive),(e=>{e&&(M.value="",D.value={type:"photo",ids:[],content:"",password:"",expired_at:null})})),_(Y,r.debounce((()=>G()),500),{deep:!0}),z((()=>{G(),window.addEventListener("keydown",Q)})),q((()=>{window.removeEventListener("keydown",Q)})),(l,s)=>(L(),w(t,{"toggle-header":!1,"show-footer":!1,"header-title":`${x($).selections.length>0?l.$t("{count} items selected",{count:x(a).format(x($).selections.length)}):l.$t("Photo Management")}`,"on-scroll":J},{default:k((()=>[A(e,{class:"max-w-full bg-white dark:bg-[var(--n-color)]"},{default:k((()=>{var e;return[S("div",oe,[s[7]||(s[7]=S("div",null,null,-1)),S("div",re,[A(x(F),{value:Y.value.q,"onUpdate:value":s[0]||(s[0]=e=>Y.value.q=e),class:"max-w-44",placeholder:l.$t("Enter keywords to search..."),clearable:""},null,8,["value","placeholder"]),A(x(O),{class:"max-w-52",filterable:"",clearable:"",placeholder:l.$t("Storage Filter"),value:Y.value.storage_id,"onUpdate:value":s[1]||(s[1]=e=>Y.value.storage_id=e),options:(null==(e=x(b).group)?void 0:e.storages)||[],"label-field":"name","value-field":"id"},null,8,["placeholder","value","options"]),A(x(O),{class:"w-32 shrink-0",placeholder:l.$t("Sort"),options:V,value:Y.value.order_by,"onUpdate:value":s[2]||(s[2]=e=>Y.value.order_by=e)},null,8,["placeholder","value"])])]),S("div",ie,[S("div",ne,[A(i)]),A(n,null,{default:k((()=>[A(d),A(u),A(c),A(p),A(se),A(te),A(v)])),_:1})])]})),_:1}),A(x(E),{show:x($).shareModalActive,"onUpdate:show":s[6]||(s[6]=e=>x($).shareModalActive=e),title:l.$t("Share Photos"),preset:"card",size:"small",bordered:!1,class:"max-w-screen-sm mx-4 md:mx-auto z-50"},{action:k((()=>[M.value?(L(),j("div",ce,[A(x(F),{class:"grow select-all","default-value":M.value,readonly:""},null,8,["default-value"]),A(x(I),{tertiary:"",type:"primary",class:"shrink-0",onClick:X},{icon:k((()=>[A(x(f),{icon:"fa-solid fa-copy"})])),_:1})])):(L(),j("div",ue,[A(x(I),{tertiary:"",onClick:W},{default:k((()=>[T(U(l.$t("Create Share Link")),1)])),_:1})]))])),default:k((()=>[S("div",de,[A(x(R),{model:D.value,rules:K,disabled:Boolean(M.value)},{default:k((()=>[A(x(B),{label:l.$t("Share Description"),path:"content"},{default:k((()=>[A(x(F),{resizable:"",type:"textarea",value:D.value.content,"onUpdate:value":s[3]||(s[3]=e=>D.value.content=e)},null,8,["value"])])),_:1},8,["label"]),A(x(B),{label:l.$t("Password"),path:"password"},{default:k((()=>[A(x(F),{type:"password",value:D.value.password,"onUpdate:value":s[4]||(s[4]=e=>D.value.password=e)},null,8,["value"])])),_:1},8,["label"]),A(x(B),{label:l.$t("Expiration Time"),path:"expired_at"},{default:k((()=>[A(x(H),{value:D.value.expired_at,"onUpdate:value":s[5]||(s[5]=e=>D.value.expired_at=e),type:"datetime",class:"w-full",placeholder:l.$t("Select Expiration Time"),"is-date-disabled":e=>e<Date.now(),clearable:""},null,8,["value","placeholder","is-date-disabled"])])),_:1},8,["label"])])),_:1},8,["model","disabled"])])])),_:1},8,["show","title"])])),_:1},8,["header-title"]))}});export{pe as default};
