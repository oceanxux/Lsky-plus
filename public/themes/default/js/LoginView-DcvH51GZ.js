import{k as e,r as a,a8 as t,o as l,a6 as r,N as o,Q as n,L as s,K as u,P as i,Y as d,U as p,j as c,a7 as v,V as m,M as g,F as y,R as f}from"./vue-vendors-B4XdlKKZ.js";import{u as b,a as _,b as h,p as k,e as w,f as $}from"./index-DZdj2b_n.js";import{_ as x}from"./AuthFormCard.vue_vue_type_script_setup_true_lang-e_3_W4XC.js";import{_ as j,c as q}from"./Layout.vue_vue_type_script_setup_true_lang-Bd80f82b.js";import{m as L,N as C,v as S,w as U,x as z,y as P,A as M,t as R,s as A,C as N,B as O,o as B,D as E,E as F}from"./naive-ui-DFBPfLe9.js";import{L as I}from"./LogInOutline-DKcl_7Vz.js";import"./utils-DGAJShNI.js";import"./icons-C1_zt0kT.js";import"./bg-BQwuMl68.js";import"./photo-components-DTzq5atJ.js";const V={key:0,class:"h-full flex justify-center items-center"},D={class:"flex justify-between"},Q={key:3,class:"mt-8 mb-4"},H={class:"flex flex-row justify-center relative"},K={class:"relative z-[2] text-sm px-4 bg-white dark:bg-[var(--n-color)] text-gray-500"},T={class:"flex justify-center space-x-6 mt-4"},W={class:"flex justify-between mt-6"},Y=e({__name:"LoginView",setup(e){var Y,G;const J=b(),X=_(),Z=h(),ee=X.getSelectOptionCountryCodes(),ae=e=>{var a,t;return(null==(t=null==(a=e.option.label)?void 0:a.toString())?void 0:t.match(/^\+\d+/))||""},te=a(!0),le=t(),re=r(),oe=L(),ne=a(null),se=a({login_type:"email",username:"",password:"",remember:!0,token:(null==(G=null==(Y=le.query)?void 0:Y.token)?void 0:G.toString())||"",country_code:"cn"}),ue=async()=>{var e,a;const t=await w({body:se.value});if("error"===(null==(e=t.data)?void 0:e.status))return oe.error(null==(a=t.data)?void 0:a.message);await ie(t.data.data.token)},ie=async e=>{Z.setToken(e),window.location.href="/user/dashboard"};return l((()=>{Z.isLoggedIn&&re.push("/user/dashboard").then((()=>{J.setSidebarOpen(!0)})),le.query.driver_id&&le.query.code?k({path:{id:le.query.driver_id.toString()},body:{code:le.query.code.toString()}}).then((e=>{var a;const t=(null==(a=e.data)?void 0:a.data.token.toString())||"";202===e.status?(re.replace({query:{token:t}}),se.value.token=t):ie(t)})).finally((()=>{te.value=!1})):te.value=!1})),(e,a)=>(s(),o(j,{"header-title":e.$t("Login")},{default:n((()=>{var t;return[te.value?(s(),u("div",V,[i(d(C),{size:"small",description:"loading..."})])):(s(),o(x,{key:1,title:e.$t("Login to {sitename}",{sitename:null==(t=d(X).configs)?void 0:t.site.title})},{default:n((()=>[se.value.token?(s(),o(d(S),{key:0,type:"info",class:"mb-4"},{default:n((()=>[c(v(e.$t("Please log in to your account. After binding, you can log in directly next time.")),1)])),_:1})):p("",!0),i(d(U),{type:"segment",class:"mb-4",value:se.value.login_type,"onUpdate:value":a[0]||(a[0]=e=>se.value.login_type=e)},{default:n((()=>{var a;return[i(d(z),{name:"email",tab:e.$t("Login with Email")},null,8,["tab"]),(null==(a=d(X).configs)?void 0:a.app.user_phone_verify)?(s(),o(d(z),{key:0,name:"phone",tab:e.$t("Login with Mobile Number")},null,8,["tab"])):p("",!0),i(d(z),{name:"username",tab:e.$t("Login with Username")},null,8,["tab"])]})),_:1},8,["value"]),i(d(P),{ref_key:"formRef",ref:ne,model:se.value,"show-require-mark":!0,onSubmit:m(ue,["prevent"])},{default:n((()=>{var t,l,r;return["email"===se.value.login_type?(s(),o(d(M),{key:0,label:e.$t("Email")},{default:n((()=>[i(d(R),{value:se.value.username,"onUpdate:value":a[1]||(a[1]=e=>se.value.username=e),"input-props":{type:"email",required:!0},placeholder:e.$t("Please enter your email"),size:"large"},null,8,["value","placeholder"])])),_:1},8,["label"])):p("",!0),"phone"===se.value.login_type?(s(),o(d(M),{key:1,label:e.$t("Mobile Number")},{default:n((()=>[i(d(A),null,{default:n((()=>[i(d(N),{options:d(ee),"render-tag":ae,"consistent-menu-width":!1,value:se.value.country_code,"onUpdate:value":a[2]||(a[2]=e=>se.value.country_code=e),class:"w-28",size:"large",filterable:"",placeholder:e.$t("Select Country")},null,8,["options","value","placeholder"]),i(d(R),{value:se.value.username,"onUpdate:value":a[3]||(a[3]=e=>se.value.username=e),placeholder:e.$t("Please enter your mobile number"),"input-props":{required:!0},size:"large"},null,8,["value","placeholder"])])),_:1})])),_:1},8,["label"])):p("",!0),"username"===se.value.login_type?(s(),o(d(M),{key:2,label:e.$t("Username")},{default:n((()=>[i(d(R),{value:se.value.username,"onUpdate:value":a[4]||(a[4]=e=>se.value.username=e),"input-props":{required:!0},placeholder:e.$t("Please enter your username"),size:"large"},null,8,["value","placeholder"])])),_:1},8,["label"])):p("",!0),i(d(M),{label:e.$t("Password"),"show-feedback":!1},{default:n((()=>[i(d(R),{value:se.value.password,"onUpdate:value":a[5]||(a[5]=e=>se.value.password=e),placeholder:e.$t("Please enter your password"),type:"password","show-password-on":"mousedown",size:"large","input-props":{required:!0}},null,8,["value","placeholder"])])),_:1},8,["label"]),i(d(M),null,{default:n((()=>[i(d(O),{type:"primary","attr-type":"submit",size:"large",strong:"",block:""},{icon:n((()=>[i(d(B),{component:d(I)},null,8,["component"])])),default:n((()=>[c(" "+v(e.$t("Login")),1)])),_:1})])),_:1}),g("div",D,[i(d(E),{"default-checked":se.value.remember,"checked-value":se.value.remember,"onUpdate:checkedValue":a[6]||(a[6]=e=>se.value.remember=e)},{default:n((()=>[c(v(e.$t("Remember Me")),1)])),_:1},8,["default-checked","checked-value"]),i(d(O),{text:"",type:"info",onClick:a[7]||(a[7]=e=>d(re).push("/forget-password"))},{default:n((()=>[c(v(e.$t("Forgot Password?")),1)])),_:1})]),!se.value.token&&((null==(t=d(X).configs)?void 0:t.app.socialites)||[]).length>0?(s(),u("div",Q,[g("div",H,[a[10]||(a[10]=g("div",{class:"absolute top-[10px] h-[1px] bg-gray-200 dark:bg-gray-500 w-[80%] z-[1]"},null,-1)),g("p",K,v(e.$t("Login with Other Methods")),1)]),g("div",T,[(s(!0),u(y,null,f((null==(l=d(X).configs)?void 0:l.app.socialites)||[],(e=>(s(),o(d(O),{text:"",onClick:a=>(async e=>{var a,t;const l=await $({path:{id:e.id.toString()},query:{redirect_url:`${q.getWithoutQueryUrl()}?driver_id=${e.id}`}});if("error"===(null==(a=l.data)?void 0:a.status))return oe.error(null==(t=l.data)?void 0:t.message);window.location.replace(l.data.data.redirect_url)})(e)},{icon:n((()=>[i(d(B),{component:d(q).getSocialiteIcon(e.provider)},null,8,["component"])])),default:n((()=>[c(" "+v(e.name),1)])),_:2},1032,["onClick"])))),256))])])):p("",!0),g("div",W,[i(d(O),{text:"",type:"info",onClick:a[8]||(a[8]=e=>d(re).push("/"))},{default:n((()=>[c(v(e.$t("Back to Home")),1)])),_:1}),i(d(F),{trigger:"hover",disabled:null==(r=d(X).configs)?void 0:r.app.enable_registration},{trigger:n((()=>{var t;return[g("p",null,[g("span",null,v(e.$t("Don't have an account?")),1),i(d(O),{text:"",type:"info",onClick:a[9]||(a[9]=e=>d(re).push({path:"/register",query:{token:se.value.token||void 0}})),disabled:!(null==(t=d(X).configs)?void 0:t.app.enable_registration)},{default:n((()=>[c(v(e.$t("Register Account")),1)])),_:1},8,["disabled"])])]})),default:n((()=>[c(" "+v(e.$t("Registration is currently closed")),1)])),_:1},8,["disabled"])])]})),_:1},8,["model"])])),_:1},8,["title"]))]})),_:1},8,["header-title"]))}});export{Y as default};
