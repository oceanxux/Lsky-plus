import{_ as e,$ as t,k as r,r as a,m as s,N as i,Q as o,P as l,Y as n,M as u,j as d,a7 as c,a6 as p,a9 as m,L as f}from"./vue-vendors-B4XdlKKZ.js";import{_ as h}from"./Content.vue_vue_type_script_setup_true_lang-CEfikmAR.js";import{u as v,_,S as y}from"./Layout.vue_vue_type_script_setup_true_lang-Bd80f82b.js";import{T as w,U as g}from"./index-DZdj2b_n.js";import{_ as k}from"./DataTable.vue_vue_type_script_setup_true_lang-Dzev82sr.js";import{m as x,G as b,S as T,a0 as j,a1 as A,a2 as $,o as C,T as P,B as L,r as W,v as z,t as U}from"./naive-ui-DFBPfLe9.js";import{P as D}from"./icons-C1_zt0kT.js";import"./photo-components-DTzq5atJ.js";import"./utils-DGAJShNI.js";const I=e("token",(()=>{const{t:e}=t();return{deleteToken:async function(t,r={},a){const{message:s,dialog:i}=a;return new Promise((a=>{const o=i.warning({title:e("Delete Token"),content:e("Once deleted, the login status of the client using this token will become invalid. Are you sure you want to delete it?"),positiveText:e("Confirm"),negativeText:e("Cancel"),onPositiveClick:()=>(o.loading=!0,new Promise((r=>{w({path:{id:t}}).then((()=>{s.success(e("Delete successfully")),r(!0)})).finally((()=>{o.loading=!1,a(!0)}))}))),...r})}))}}})),M={class:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between"},q={class:"grow md:grow-0 md:basis-1/2"},K=r({__name:"IndexView",setup(e){const r=p(),{t:w}=t(),K=a(),O=I(),S=x(),B=b(),E=[{title:w("Token Name"),key:"name",minWidth:200},{title:w("Permissions"),key:"abilities",minWidth:150,render:e=>!e.abilities||Array.isArray(e.abilities)&&e.abilities.includes("*")?s(T,{type:"warning"},{default:()=>w("Full Access")}):s(j,{trigger:"hover",placement:"bottom",width:300},{trigger:()=>s(T,{type:"info"},{default:()=>s("span",{},`${e.abilities.length} ${w("Permissions")}`)}),default:()=>s(A,{hoverable:!0,bordered:!1,style:"max-height: 400px; overflow-y: auto;"},{header:()=>s("div",{class:"font-bold pb-2"},w("Granted Permissions")),default:()=>e.abilities.map((e=>s($,{key:e},{default:()=>s("div",{class:"flex items-center gap-2"},[s(C,{size:16,color:"#18a058"},{default:()=>s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor"},[s("path",{d:"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"})])}),s("span",{},Y(e))])})))})})},{title:w("Last Used Time"),minWidth:150,key:"last_used_at",sorter:!0,align:"center",render:e=>e.last_used_at?v(e.last_used_at).format("L"):"-"},{title:w("Expires Time"),minWidth:150,key:"expires_at",sorter:!0,align:"center",render:e=>e.expires_at?v(e.expires_at).format("L"):"-"},{title:w("Creation Time"),minWidth:150,key:"created_at",sorter:!0,align:"center",render:e=>v(e.created_at).format("L")},{title:w("Actions"),key:"actions",minWidth:150,fixed:"right",align:"center",render:e=>s(P,{vertical:!1,size:5,justify:"center"},{default:()=>[s(L,{size:"small",type:"error",onClick:()=>{O.deleteToken(e.id,{},{message:S,dialog:B}).finally((()=>{var e;R.value=[],null==(e=K.value)||e.refresh()}))}},{default:()=>w("Delete Token")})]})}],G=a(""),N=a("sort:latest"),R=a([]),F=e=>g({query:{page:e,per_page:40,q:`${G.value} ${N.value}`.trim()}});function Q(e){var t;e.order?N.value=`sort:${e.columnKey}:${e.order}`:N.value="sort:latest",null==(t=K.value)||t.refresh()}function V(){var e;null==(e=K.value)||e.refresh()}const Y=e=>({basic:"基础权限","user:profile:read":"读取用户资料","user:profile:write":"更新用户资料","user:token:read":"查看个人令牌","user:token:write":"管理个人令牌","user:group:read":"查看用户角色组","user:group:write":"管理用户角色组","user:capacity:read":"查看用户容量","user:capacity:write":"管理用户容量","user:album:read":"查看相册","user:album:write":"管理相册","user:photo:read":"查看照片","user:photo:write":"管理照片","user:share:read":"查看分享","user:share:write":"管理分享","user:ticket:read":"查看工单","user:ticket:write":"管理工单","user:order:read":"查看订单","user:order:write":"管理订单","oauth:read":"查看OAuth信息","oauth:write":"管理OAuth绑定","explore:read":"浏览探索内容","explore:write":"管理探索互动","upload:write":"上传图片"}[e]||e);return(e,t)=>(f(),i(_,{"header-title":e.$t("My Tokens"),"toggle-header":!1,"show-footer":!1},{default:o((()=>[l(h,{class:"mx-auto p-4 md:p-10 space-y-10"},{default:o((()=>[l(n(W),null,{default:o((()=>[l(n(P),{vertical:""},{default:o((()=>[l(n(z),{type:"info","show-icon":""},{default:o((()=>[d(c(e.$t("API tokens are used to authenticate API requests. Create tokens with specific permissions to improve security. Tokens with no permissions will have full access.")),1)])),_:1}),u("div",M,[u("div",null,[l(n(L),{tertiary:"",onClick:t[0]||(t[0]=()=>{n(r).push("/user/tokens/create")})},{icon:o((()=>[l(n(C),{component:n(D)},null,8,["component"])])),default:o((()=>[d(" "+c(e.$t("Create Token")),1)])),_:1})]),u("div",q,[l(n(U),{value:G.value,"onUpdate:value":t[1]||(t[1]=e=>G.value=e),placeholder:e.$t("Enter keywords to search..."),onKeyup:m(V,["enter","native"])},{prefix:o((()=>[l(n(C),{component:n(y)},null,8,["component"])])),_:1},8,["value","placeholder"])])]),l(k,{striped:"",ref_key:"tableRef",ref:K,bordered:!1,fetch:F,columns:E,"row-key":e=>e.id,"checked-row-keys":R.value,"onUpdate:checkedRowKeys":t[2]||(t[2]=e=>R.value=e),onUpdateSorter:Q},null,8,["row-key","checked-row-keys"])])),_:1})])),_:1})])),_:1})])),_:1},8,["header-title"]))}});export{K as default};
