import{_ as e,u as a,c as l}from"./Layout.vue_vue_type_script_setup_true_lang-Bd80f82b.js";import{_ as t}from"./Content.vue_vue_type_script_setup_true_lang-CEfikmAR.js";import{b as s,Q as o,R as r,S as n}from"./index-DZdj2b_n.js";import{k as u,K as i,L as d,M as c,$ as v,r as p,o as f,a8 as m,c as _,N as w,Q as g,P as x,Y as h,j as b,a7 as k,U as y,R as j,F as T}from"./vue-vendors-B4XdlKKZ.js";import{_ as $}from"./Back.vue_vue_type_script_setup_true_lang-CZlTXmSD.js";import{m as R,r as C,_ as z,$ as S,X as L,Y as N,q as U,N as A,t as M,B,o as D,p as H}from"./naive-ui-DFBPfLe9.js";import"./icons-C1_zt0kT.js";import"./photo-components-DTzq5atJ.js";import"./utils-DGAJShNI.js";const I={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},P=[c("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 244l144-144l144 144"},null,-1),c("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M256 120v292"},null,-1)],q=u({name:"ArrowUpOutline",render:function(e,a){return d(),i("svg",I,P)}}),Q={class:"flex flex-col space-y-2 h-full"},Y={class:"flex-none space-x-2"},F={key:0,class:"flex space-x-2 overflow-hidden mb-5"},K={class:"flex flex-col items-end space-y-1 grow"},O={class:"text-gray-500 text-xs"},V={class:"flex-none w-fit inline-block bg-[#20b2e5] text-white overflow-hidden break-all p-2 rounded-lg md:max-w-[80%]"},X={key:1,class:"flex space-x-2 overflow-hidden mb-5"},E={class:"flex flex-col space-y-1 grow"},G={class:"text-gray-500 text-xs"},J={class:"flex-none w-fit inline-block bg-gray-200 dark:bg-gray-700 overflow-hidden break-all p-2 rounded-lg md:max-w-[80%]"},W={class:"shrink-0 w-full mt-5"},Z=u({__name:"DetailView",setup(u){const I=m(),P=R(),Z=s(),{t:ee}=v(),ae=p({}),le=p(!0),te=p(0),se=p([]),oe=p(!1),re=p(),ne=p("");function ue(){setTimeout((()=>{var e,a,l,t,s;null==(s=null==(e=re.value)?void 0:e.scrollbarInstRef)||s.scrollTo({top:(null==(t=null==(l=null==(a=re.value)?void 0:a.scrollbarInstRef)?void 0:l.contentRef)?void 0:t.scrollHeight)||0,behavior:"smooth"})}),50)}async function ie(){var e,a,l,t;if(!ne.value)return;const s=await n({path:{issue_no:I.params.issue_no.toString()},body:{content:ne.value,is_notify:!0}});if("error"===(null==(e=s.data)?void 0:e.status))return P.error(null==(a=s.data)?void 0:a.message);se.value.push({content:ne.value,created_at:new Date,user:{avatar:null==(l=Z.profile)?void 0:l.avatar_url,name:null==(t=Z.profile)?void 0:t.name}}),ne.value="",ue()}f((async()=>{var e,a,l;const t=await o({path:{issue_no:I.params.issue_no.toString()}});if("error"===(null==(e=t.data)?void 0:e.status))return P.error(null==(a=t.data)?void 0:a.message);ae.value=(null==(l=t.data)?void 0:l.data)||{},await async function(){var e,a,l;if(oe.value)return;te.value++,le.value=!0;const t=await r({path:{issue_no:I.params.issue_no.toString()},query:{page:1,per_page:9999}});se.value.push(...(null==(e=t.data)?void 0:e.data.data)||[]),le.value=!1,oe.value=(null==(a=t.data)?void 0:a.data.current_page)===(null==(l=t.data)?void 0:l.data.last_page),ue()}()}));const de=_((()=>({low:ee("Low"),medium:ee("Medium"),high:ee("High")}))),ce=_((()=>({in_progress:ee("Processing"),completed:ee("Completed")})));return(s,o)=>(d(),w(e,{"header-title":s.$t("Ticket Details"),"toggle-header":!1,"show-footer":!1},{default:g((()=>[x(t,{class:"mx-auto p-4 md:p-10 space-y-10 h-full"},{default:g((()=>[c("div",Q,[c("div",Y,[x($,{to:"/user/tickets"})]),x(h(C),null,{default:g((()=>[x(h(z),{accordion:"","default-expanded-names":"info"},{default:g((()=>[x(h(S),{title:s.$t("Ticket Information"),name:"info"},{default:g((()=>[x(h(L),{size:"small",bordered:""},{default:g((()=>[x(h(N),{label:s.$t("Ticket Number")},{default:g((()=>[b(k(ae.value.issue_no),1)])),_:1},8,["label"]),x(h(N),{label:s.$t("Ticket Title")},{default:g((()=>[b(k(ae.value.title),1)])),_:1},8,["label"]),x(h(N),{label:s.$t("Ticket Level")},{default:g((()=>[b(k(de.value[ae.value.level]),1)])),_:1},8,["label"]),x(h(N),{label:s.$t("Ticket Status")},{default:g((()=>[b(k(ce.value[ae.value.status]),1)])),_:1},8,["label"]),x(h(N),{label:s.$t("Creation Time")},{default:g((()=>[b(k(h(a)(ae.value.created_at).format("L")),1)])),_:1},8,["label"])])),_:1})])),_:1},8,["title"])])),_:1})])),_:1}),x(h(C),{class:"grow w-full overflow-hidden","content-class":"flex flex-col overflow-hidden"},{default:g((()=>[x(h(U),{ref_key:"infiniteScrollRef",ref:re,class:"grow w-full"},{default:g((()=>[le.value?(d(),w(h(A),{key:0,size:"small",class:"w-full my-10"})):y("",!0),(d(!0),i(T,null,j(se.value,(e=>{var t;return d(),i(T,null,[e.user.id==(null==(t=h(Z).profile)?void 0:t.id)?(d(),i("div",F,[c("div",K,[c("p",null,[c("span",O,k(h(a)(e.created_at).fromNow()),1),b(" "+k(e.user.name),1)]),c("p",V,k(e.content),1)]),x(h(H),{class:"shrink-0",round:"",src:h(l).getUserAvatar(e.user.avatar_url)},null,8,["src"])])):(d(),i("div",X,[x(h(H),{class:"shrink-0",round:"",src:h(l).getUserAvatar(e.user.avatar_url)},null,8,["src"]),c("div",E,[c("p",null,[b(k(e.user.name)+" ",1),c("span",G,k(h(a)(e.created_at).fromNow()),1)]),c("p",J,k(e.content),1)])]))],64)})),256))])),_:1},512),c("div",W,[x(h(M),{value:ne.value,"onUpdate:value":o[0]||(o[0]=e=>ne.value=e),size:"large",type:"textarea",autosize:{minRows:1,maxRows:4},class:"w-full",placeholder:"completed"===ae.value.status?s.$t("Ticket Completed"):s.$t("Please describe your problem"),disabled:"completed"===ae.value.status},{suffix:g((()=>[x(h(B),{strong:"",secondary:"",circle:"",type:"primary",size:"small",onClick:ie,disabled:"completed"===ae.value.status||""==ne.value},{icon:g((()=>[x(h(D),{size:14,component:h(q)},null,8,["component"])])),_:1},8,["disabled"])])),_:1},8,["value","placeholder","disabled"])])])),_:1})])])),_:1})])),_:1},8,["header-title"]))}});export{Z as default};
